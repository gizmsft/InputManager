function CaretLocator(t,e){"use strict";const s=t instanceof jQuery?t:$(t),d=s.get(0),l=d.nodeName.toUpperCase(),a={TextArea:"TEXTAREA",Input:"INPUT"};t=l;if(t!=a.TextArea&&t!=a.Input)throw"unsupported element type '"+t+"' for InputManager";const g={marker:$("<span style='white-space: nowrap; padding: 0; margin: 0;'>â€‹</span>"),debug:!1,settings:null};g.settings=$.extend(!0,{},{debug:!1},e),g.debug=g.settings.debug;var h=$("<div></div>").css({"border-width":"1px","border-style":"solid",overflow:"hidden","box-sizing":"border-box","white-space":"pre-wrap","word-wrap":"break-word",position:"absolute",top:g.debug?s.position().top+"px":"0px",left:g.debug?s.position().left+s.width()+100+"px":"-9999px",visibility:g.debug?"visible":"hidden"}),c=$("<div></div>").css({"border-width":"1px","border-style":"solid",overflow:"hidden","box-sizing":"border-box","white-space":"nowrap","word-wrap":"nowrap",position:"absolute",top:g.debug?s.position().top+"px":"0px",left:g.debug?s.position().left+s.width()+100+"px":"-9999px",visibility:g.debug?"visible":"hidden"}),b=["font-family","font-size","font-weight","font-style","font-variant","font-stretch","font-size-adjust","line-height","border-top-width","border-right-width","border-bottom-width","border-left-width","border-style","padding-top","padding-left","padding-bottom","padding-right","box-sizing","width","height","overflow-x","overflow-y","tab-size","moz-tab-size","line-height","letter-spacing","word-spacing","text-decoration","text-align","text-transform","text-indent","direction"],u=["font-family","font-size","font-weight","font-style","font-variant","padding-top","padding-left","padding-bottom","padding-right","line-height","letter-spacing","word-spacing","text-decoration","text-align","direction"];this.setHighlight=function(t,e,i,o){var n;t.empty(),o&&(l==a.TextArea?(n=s.css(b),t.css(n),t.append(e.substr(0,e.length-o.length)),t.append($("<span style='background-color: yellow; color: transparent;'></span>").append(o)),t.append(i),t.css({top:-1*s.scrollTop()})):l==a.Input&&(n=s.css(u),t.css(n),t.append(e.substr(0,e.length-o.length)),t.append($("<span style='background-color: yellow; color: transparent;'></span>").append(o)),t.append(i)))},this.unsetHighlight=function(t){t.empty()},this.setDebug=function(t){g.debug=!!t},this.getCursorOffset=function(t,e){var i,o,n,r=d.clientHeight,p=d.clientWidth;return l==a.TextArea?(i=s.css(b),$.extend(i,{height:r-2,width:p-2}),h.appendTo(s.parent()).css(i).empty().append(t,g.marker,e),o={top:null,right:null,left:null,height:null,isRTL:!1},n=g.marker.position(),o.height=g.marker.height(),o.top=n.top-s.scrollTop(),o.bottom=r-o.top,o.isRTL="rtl"===s.css("direction")||"rtl"===d.dir,o.left=n.left,o.right=p-n.left,g.debug||(h.empty(),h.remove()),o):l==a.Input?(r=d.clientHeight,p=d.clientWidth,i=s.css(u),$.extend(!0,i,{height:r-2,"min-width":p-2}),c.appendTo(s.parent()).css(i).empty().append(t,g.marker,e),o={top:null,right:null,left:null,height:null,isRTL:!1},n=g.marker.position(),o.height=g.marker.height(),o.top=n.top,o.bottom=r-o.top,o.isRTL="rtl"===s.css("direction")||"rtl"===d.dir,o.left=n.left-s.scrollLeft(),o.right=p-n.left,g.debug||(c.empty(),c.remove()),o):void 0}}
function InputManager(e,t){"use strict";var n=this,s=e instanceof jQuery?e:$(e),o=s.get(0),e=o.nodeName.toLowerCase();if("input"!=e&&"textarea"!=e)throw"unsupported element type '"+e+"' for inputManager";const i={debug:!1,enabled:!0,bufferedCusorPosition:0,settings:null},r=(i.settings=$.extend(!0,{},{containerClass:"input-manager",debug:!1,enabled:!0,highlightTemplate:"<div class='highlight'></div>",events:{onKeydown:null,onKeyup:null,onCursorPositionChanged:null}},t),i.debug=i.settings.debug,i.enabled=i.settings.enabled,s.addClass(i.settings.containerClass),new CaretLocator(s,{debug:i.debug}));this.getTarget=function(){return s},this.getSettings=function(){return i.settings},this.setDebug=function(e){i.debug=!!e,r.setDebug(e)},this.setEnabled=function(e){i.enabled=e},this.getEnabled=function(){return i.enabled},this.getCursorOffset=function(e,t){return r.getCursorOffset(e,t)},this.setHighlight=function(e,t,n,s){r.setHighlight(e,t,n,s)},this.unsetHighlight=function(e){r.unsetHighlight(e)},this.getCursorPosition=function(){var e=o.selectionEnd;return"number"==typeof e?e:document.selection?((e=o.createTextRange()).moveStart("character",0),e.moveEnd("textedit"),e.text.length):void 0},this.setCursorPosition=function(e){var t;s.is(":focus")&&("number"==typeof o.selectionEnd?o.selectionStart=o.selectionEnd=e:o.createTextRange&&((t=o.createTextRange()).move("character",e),t.select()))},this.getSelectedText=function(){var e,t=o.selectionStart;return"number"==typeof t?(e=o.selectionEnd,o.value.substring(t,e)):document.selection?o.selection.createRange().text:void 0},this.getInputState=function(){return a()},this.updateCursorPosition=function(){u()};var u=function(){var e,t;i.settings.events.onCursorPositionChanged&&i.enabled&&s.is(":focus")&&(t=n.getCursorPosition(),i.bufferedCusorPosition!=t&&(i.bufferedCusorPosition=t,e=a(),t=$.extend({cursorPosition:t},e),i.settings.events.onCursorPositionChanged.call(n,t)))},a=function(){var e=c(),t=s.val().substring(e.length);return{preText:e,postText:t,cursorOffset:g(e,t)}},c=function(){var e=o.selectionEnd;return"number"==typeof e?o.value.substring(0,e):document.selection?((e=o.createTextRange()).moveStart("character",0),e.moveEnd("textedit"),e.text):void 0},g=function(e,t){return r.getCursorOffset(e,t)};s.on("keydown",function(e){var t;i.settings.events.onKeydown&&i.enabled&&(t=a(),e=$.extend(e,t),i.settings.events.onKeydown.call(n,e))}),s.on("keyup",function(e){var t;i.settings.events.onKeyup&&i.enabled&&(t=a(),e=$.extend(e,t),i.settings.events.onKeyup.call(n,e))}),s.on("keypress keydown keyup input click paste change",u)}